# Standalone Pipeline to run Automated E2E tests on demand
# Using rsp-iras-qa repo

name: Run Playwright Tests

trigger:
  - main

schedules:
  - cron: '0 0 * * Mon-Fri'
    displayName: 'Nightly run - full suite'
    branches:
      include:
        - main
    always: true

pool:
  vmImage: 'Ubuntu-latest'

parameters:
  - name: platform
    displayName: Select a Platform
    type: string
    default: desktop
    values:
      - desktop
      - mobile
  - name: os_type
    displayName: Select mobile OS type
    type: string
    default: iOS
    values:
      - iOS
      - Android
  - name: ANDROID_Device
    displayName: Select any Android Device
    type: string
    default: Pixel 7
    values:
      - Pixel 7
      - Galaxy S9+
      - Galaxy S8
      - Pixel 5
  - name: IOS_Device
    displayName: Select any iOS Device
    type: string
    default: iPhone 15 Pro
    values:
      - iPhone 15 Pro
      - iPhone 15
      - iPhone 15 Plus
      - iPhone 15 Pro Max
      - iPhone 14 Pro Max
  - name: browser
    displayName: Select a Browser
    type: string
    default: chromium
    values:
      - chromium
      - safari
      - firefox
  - name: devops_library_branch
    displayName: DevOps Library Branch
    type: string
    default: main
  - name: tests_run_timeout
    type: number
    displayName: Playwright Tests Run Timeout
    default: 10
  - name: run_sonarcloud_analysis
    displayName: Run SonarCloud Analysis
    default: true

variables:
  - group: 'Test Automation'

resources:
  repositories:
    - repository: library
      type: git
      name: DevOps/rsp-azure-devops-library
      ref: ${{ parameters.devops_library_branch }}

stages:
  - stage: E2EPlaywrightTests
    displayName: E2E Playwright Tests
    jobs:
      - template: jobs/e2e_tests.yaml@library
        parameters:
          browser: ${{ parameters.browser }}
          upload_to_sharepoint: true
          tests_run_timeout: ${{ parameters.tests_run_timeout }}
          sonar_project_key: FutureIRAS_rsp-iras-qa
          sonar_project_name: rsp-iras-qa
          run_sonarcloud_analysis: ${{ parameters.run_sonarcloud_analysis }}
