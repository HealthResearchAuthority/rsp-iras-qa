# Standalone Pipeline to run Automated E2E tests on demand
# Using rsp-iras-qa repo

name: Run Playwright Tests

trigger:
  - feature/rsp-1507-update-playwright-report

schedules:
  - cron: '20 16 17 10 Mon-Fri'
    displayName: 'Nightly run - full suite'
    branches:
      include:
        - feature/rsp-1507-update-playwright-report
    always: true

pool:
  vmImage: 'Ubuntu-latest'

parameters:
  - name: browser
    displayName: Select a Browser
    type: string
    default: chromium
    values:
      - chromium
      - safari
      - firefox
      - ios
      - android
  - name: devops_library_branch
    displayName: DevOps Library Branch
    type: string
    #default: main
    default: rsp-1507-update-playwright-report-yaml
  - name: tests_run_timeout
    type: number
    displayName: Playwright Tests Run Timeout
    default: 10
  - name: run_sonarcloud_analysis
    displayName: Run SonarCloud Analysis
    default: true

variables:
  - group: 'Test Automation'

resources:
  repositories:
    - repository: library
      type: git
      name: DevOps/rsp-azure-devops-library
      ref: ${{ parameters.devops_library_branch }}

stages:
  - stage: E2EPlaywrightTests
    displayName: E2E Playwright Tests
    jobs:
      - template: jobs/e2e_tests.yaml@library
        parameters:
          browser: ${{ parameters.browser }}
          upload_to_sharepoint: true
          tests_run_timeout: ${{ parameters.tests_run_timeout }}
          sonar_project_key: FutureIRAS_rsp-iras-qa
          sonar_project_name: rsp-iras-qa
          run_sonarcloud_analysis: ${{ parameters.run_sonarcloud_analysis }}
